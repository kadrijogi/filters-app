<!-- Filter Modal (Bootstrap) -->
<div class="modal fade" id="addFilterModal" tabindex="-1" aria-labelledby="addFilterModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addFilterModalLabel">Add New Filter</h5>
        <button type="button" class="btn-close" (click)="close()" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form #filterForm="ngForm">
          <h6>Filter Name <span class="text-danger">*</span></h6>
          <div class="mb-3">
            <input
              required
              type="text"
              class="form-control"
              id="filterName"
              [(ngModel)]="filterToEdit.name"
              name="filterName"
              #filterName="ngModel"
            />
            <!-- Error message for required field -->
            <div *ngIf="filterName.invalid && filterName.touched" class="text-danger">
              Filter Name is required.
            </div>
          </div>
          <h6>Criteria <span class="text-danger">*</span></h6>
          <div *ngFor="let criterion of filterToEdit.criteria; let i = index" class="criteria-form border rounded p-3 mb-3">
            <div class="row">
              <div class="row col-md-11 align-items-center">
                <!-- Criteria Type -->
                <div class="col-md-4 my-1">
                  <select
                    required
                    class="form-select"
                    id="criteriaType-{{ i }}"
                    [(ngModel)]="criterion.criteriaType"
                    [name]="'criteriaType' + i"
                    (change)="onCriteriaTypeChange(i)"
                    #criteriaType="ngModel"
                  >
                    <option value="AmountCriteria">Amount</option>
                    <option value="TitleCriteria">Title</option>
                    <option value="DateCriteria">Date</option>
                  </select>
                  <div *ngIf="criteriaType.invalid && criteriaType.touched" class="text-danger error-placeholder">
                    Criteria Type is required.
                  </div>
                </div>

                <!-- Comparison Type -->
                <div class="col-md-4 my-1" *ngIf="criterion.criteriaType">
                  <select
                    required
                    class="form-select"
                    id="comparisonType-{{ i }}"
                    [(ngModel)]="criterion.comparisonType"
                    [name]="'comparisonType' + i"
                    #comparisonType="ngModel"
                  >
                    <option *ngFor="let option of comparisonTypeOptions[criterion.criteriaType]" [value]="option.value">
                      {{ option.label }}
                    </option>
                  </select>
                  <div *ngIf="comparisonType.invalid && comparisonType.touched" class="text-danger error-placeholder">
                    Comparison Type is required.
                  </div>
                </div>

                <!-- Conditional fields based on selected criteria type -->
                <div *ngIf="criterion.criteriaType === 'AmountCriteria'" class="col-md-4 my-1">
                  <input
                    required
                    type="number"
                    class="form-control"
                    id="amount-{{ i }}"
                    [(ngModel)]="criterion.amount"
                    [name]="'amount' + i"
                    placeholder="Amount value"
                    #amount="ngModel"
                  />
                  <div *ngIf="amount.invalid && amount.touched" class="text-danger error-placeholder">
                    Amount value is required.
                  </div>
                </div>

                <div *ngIf="criterion.criteriaType === 'TitleCriteria'" class="col-md-4 my-1">
                  <input
                    required
                    type="text"
                    class="form-control"
                    id="title-{{ i }}"
                    [(ngModel)]="criterion.title"
                    [name]="'title' + i"
                    placeholder="Title value"
                    #title="ngModel"
                  />
                  <div *ngIf="title.invalid && title.touched" class="text-danger error-placeholder">
                    Title value is required.
                  </div>
                </div>

                <div *ngIf="criterion.criteriaType === 'DateCriteria'" class="col-md-4 my-1">
                  <input
                    required
                    type="date"
                    class="form-control"
                    id="date-{{ i }}"
                    [(ngModel)]="criterion.date"
                    [name]="'date' + i"
                    #date="ngModel"
                  />
                  <div *ngIf="date.invalid && date.touched" class="text-danger error-placeholder">
                    Date value is required.
                  </div>
                </div>
              </div>
              <div class="col-md-1 my-1 align-self-center">
                <button
                  type="button"
                  class="btn btn-danger btn-sm ms-auto btn-icon-minus float-end"
                  (click)="removeCriterion(i)">
                  <i class="fa fa-minus"></i>
                </button>
              </div>
            </div>
          </div>

          <!-- Button to Add New Criterion -->
          <button type="button" class="btn btn-secondary mt-3" (click)="addCriterion()"><i class="fa-solid fa-plus"></i> Add Criterion</button>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="close()">Cancel</button>
        <button type="button" class="btn btn-primary" [disabled]="filterForm.invalid" (click)="save()">Save Filter</button>
      </div>
    </div>
  </div>
</div>
